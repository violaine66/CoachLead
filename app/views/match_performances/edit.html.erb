<div class="container mt-5">
  <div class="row d-flex justify-content-center">
    <div class="col-sm-8 col-md-6 col-lg-6">

      <%= simple_form_for @match_performance do |f| %>


        <div class="form-group mt-2">
          <!-- Saisie de la date du match -->
          <%= f.label :match_date, "Date du match" %>
          <%= f.date_field :match_date, class: "form-control" %>
        </div>

        <div class="form-group mt-2">
          <!-- Participation -->
          <%= f.input :played, label: "Participation", as: :boolean %>
        </div>

        <div class="form-group mt-2">
          <!-- Buts du joueur -->
          <%= f.input :buts, selected: f.object.buts || 0, label: "Buts" %>
        </div>

        <div class="form-group mt-2">
          <!-- Passes décisives du joueur -->
          <%= f.input :passes, selected: f.object.passes || 0, label: "Passes décisives" %>
        </div>

       <div id="yellow_cards">
          <%= f.simple_fields_for :yellow_cards do |yc| %>
            <div class="form-group d-flex align-items-center mb-2">
              <%= yc.input :reason, collection: YellowCard.reasons.keys.map { |r| [r.humanize, r] }, label: false, include_blank: "Sélectionner la raison" %>
              <%= yc.input :_destroy, as: :boolean, label: "Supprimer", wrapper_html: { class: "ms-3" } %>
            </div>
          <% end %>
        </div>

        <div>
          <%= link_to 'Ajouter un carton jaune', '#', id: 'add_yellow_card', class: 'btn btn-outline-secondary mb-3' %>
        </div>


    <!-- Template caché pour nouveau carton jaune à ajouter via JS -->
    <div id="yellow_card_template" style="display: none;">
      <%= f.simple_fields_for :yellow_cards, YellowCard.new, child_index: "new_yellow_card" do |yc| %>
        <div class="form-group d-flex align-items-center mb-2">
          <%= yc.input :reason, collection: YellowCard.reasons.keys.map { |r| [r.humanize, r] }, label: false, include_blank: "Sélectionner la raison" %>
          <%= yc.input :_destroy, as: :boolean, label: "Supprimer", wrapper_html: { class: "ms-3 text-dark" } %>
        </div>
      <% end %>
    </div>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const addButton = document.getElementById("add_yellow_card");
          const container = document.getElementById("yellow_cards");
          const template = document.getElementById("yellow_card_template").innerHTML;

          addButton.addEventListener("click", (e) => {
            e.preventDefault();
            const newId = new Date().getTime();
            const newFields = template.replace(/new_yellow_card/g, newId);
            container.insertAdjacentHTML('beforeend', newFields);
          });
        });
      </script>



        <div class="form-group mt-2">
          <!-- Temps de jeu -->
          <%= f.input :tempsde_jeu, label: "Temps de jeu effectif (minutes)" %>
        </div>

        <div class="form-group mt-2">
          <!-- Note du match -->
          <%= f.input :note_match, label: "Note de match (/10)", as: :float, input_html: { step: "0.1" } %>
        </div>

        <div class="form-group mt-2">
          <!-- Commentaires -->
          <%= f.input :commentaires, label: "Commentaires" %>
        </div>

        <!-- Bouton de soumission -->
        <%= f.button :submit, class: "btn btn-primary", label:"Enregistrer" %>
        <%= link_to"Retour", match_performances_path, class:"btn btn-secondary text-white"%>
      <% end %> <!-- <=== ce end ferme le bloc simple_form_for -->


    </div>
  </div>
</div>
